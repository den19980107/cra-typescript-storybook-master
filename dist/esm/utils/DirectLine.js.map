{"version":3,"sources":["../../../src/utils/DirectLine.ts"],"names":["Configuration","createDirectLine","BotFrameworkWebChat_createDirectLine","directLine","directLineOptions","token","url","domain","conversationId","res","fetch","method","body","JSON","stringify","userId","get","headers","Headers","json","console","log","getDirectLine","endDirectLine","end","getWatermark","watermark","addCurrentUser","next","config","postActivity","from","id","name","userName","membersAdded","type","subscribe","error","err","complete","removeCurrentUser","membersRemoved","addMembers","members","removeMembers"],"mappings":"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","sourcesContent":["import Configuration from \"./Configuration\"\nimport { createDirectLine as BotFrameworkWebChat_createDirectLine } from 'botframework-webchat'\nlet directLine: BotFrameworkWebChat.IDirectLine = null\n\nconst createDirectLine = async (directLineOptions: GSSWebChat.IDirectLineOptions): Promise<BotFrameworkWebChat.IDirectLine> => {\n    if (directLineOptions.token) {\n        directLine = BotFrameworkWebChat_createDirectLine(directLineOptions)\n    }\n    else {\n        //fetchToken\n        const url = directLineOptions.domain + '/tokens/generate/' + directLineOptions.conversationId\n        const res = await fetch(url, {\n            method: 'POST',\n            body: JSON.stringify({ userId: Configuration.get().userId }),\n            headers: new Headers({\n                'Content-Type': 'application/json'\n            })\n        })\n        const { token } = await res.json()\n\n        directLine = BotFrameworkWebChat_createDirectLine({ ...directLineOptions, token })\n    }\n\n    console.log('conversationId: ' + directLine.conversationId)\n    console.log('createDirectLine')\n\n    return directLine\n}\n\nconst getDirectLine = () => directLine\n\nconst endDirectLine = () => {\n    directLine && directLine.end()\n    directLine = null\n}\n\nconst getWatermark = () => directLine && directLine.watermark || 0\n\n/* post activity */\n//Activity types: https://docs.microsoft.com/zh-tw/azure/bot-service/dotnet/bot-builder-dotnet-activities?view=azure-bot-service-3.0\n\nconst addCurrentUser = (next: Function) => {\n    const config = Configuration.get()\n\n    directLine && directLine.postActivity({\n        from: { id: config.userId, name: config.userName },\n        membersAdded: [{ id: config.userId }],\n        type: 'conversationUpdate'\n    }).subscribe({\n        next: (id: any) => next && next(id),\n        error: (err: any) => console.log(`Oops...addCurrentUser: ${err}`),\n        complete: () => console.log('addCurrentUser complete.')\n    })\n}\n\nconst removeCurrentUser = (next: Function) => {\n    const config = Configuration.get()\n\n    directLine && directLine.postActivity({\n        from: { id: config.userId, name: config.userName },\n        membersRemoved: [{ id: config.userId }],\n        type: 'conversationUpdate'\n    }).subscribe({\n        next: (id: any) => next && next(id),\n        error: (err: any) => console.log(`Oops...removeMembers: ${err}`),\n        complete: () => console.log('removeMembers complete.')\n    })\n}\n\nconst addMembers = (members: Array<GSSWebChat.IMember>, next: Function) => {\n    const config = Configuration.get()\n\n    directLine && directLine.postActivity({\n        from: { id: config.userId, name: config.userName },\n        membersAdded: members,\n        type: 'conversationUpdate'\n    }).subscribe({\n        next: (id: any) => next && next(id),\n        error: (err: any) => console.log(`Oops...addMembers: ${err}`),\n        complete: () => console.log('addMembers complete.')\n    })\n}\n\nconst removeMembers = (members: Array<GSSWebChat.IMember>, next: Function) => {\n    const config = Configuration.get()\n\n    directLine && directLine.postActivity({\n        from: { id: config.userId, name: config.userName },\n        membersRemoved: members,\n        type: 'conversationUpdate'\n    }).subscribe({\n        next: (id: any) => next && next(id),\n        error: (err: any) => console.log(`Oops...removeMembers: ${err}`),\n        complete: () => console.log('removeMembers complete.')\n    })\n}\n\nexport default {\n    getWatermark,\n    addMembers,\n    removeMembers,\n    addCurrentUser,\n    removeCurrentUser\n}\n\nexport {\n    createDirectLine,\n    getDirectLine,\n    endDirectLine\n}"],"file":"DirectLine.js"}